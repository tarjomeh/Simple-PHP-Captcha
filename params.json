{
  "name": "Simple-php-captcha",
  "tagline": "",
  "body": "In order to create a Simple PHP Captcha, we will need to create a Session in the main page where our captcha is going to appear. In the second step, we need to set a session variable with a Random String. The random string should be converted to image using imagettftext() and then it is called with cURL in base64 and it is added to the page. The captcha checking form sends the user input to a response page where it is checked against the session variable.\r\n\r\n## Index.php\r\n    <?\r\n    //Start Session\r\n    session_start(); \r\n    \r\n    // Generate A Random String\r\n    function generateRandomString($length = 5) {\r\n    $characters = '0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ';\r\n    $charactersLength = strlen($characters);\r\n    $randomString = '';\r\n    for ($i = 0; $i < $length; $i++) {\r\n    $randomString .= $characters[rand(0, $charactersLength - 1)];\r\n    }\r\n    return $randomString;\r\n    }\r\n    // Assign the Session With Random String\r\n    $_SESSION['code'] = generateRandomString();\r\n    $thcode = $_SESSION['code'];\r\n    \r\n    // Convert String to Image and Grab it with CURL while it is Base64\r\n    $url = \"image.php?t=$_SESSION[code]\";\r\n    $curl = curl_init($url);\r\n    curl_setopt($curl, CURLOPT_RETURNTRANSFER, true );\r\n    $ret_val = curl_exec($curl);\r\n    $b64_image_data =  chunk_split(base64_encode($ret_val));\r\n    curl_close($curl);\r\n\r\n    // Show the Image\r\n    echo \"<img id='codeId' src='data:image/jpg;base64,$b64_image_data'><br><br>\r\n    \r\n    // Captcha Checking Form\r\n    <form name='captchaCheck' action='response.php' method='POST'>\r\n    <input name='code' type='text' required>\r\n    </form>\";\r\n    \r\n    ?>\r\n\r\n## Image.php\r\nThis page creates an image from our random string. You need to upload a font like \"arial.ttf\" in your root dir or any other folder.\r\n    <?\r\n    //IMAGE Creator\r\n    \r\n\t$text = $_GET[t];\r\n\theader('Content-type: image/jpeg');\r\n\t$im = imagecreatetruecolor(400, 30);\r\n    \t$white = imagecolorallocate($im, 255, 255, 255);\r\n    \t$grey = imagecolorallocate($im, 128, 128, 128);\r\n    \t$black = imagecolorallocate($im, 0, 0, 0);\r\n    \timagefilledrectangle($im, 0, 0, 399, 29, $white);\r\n    \t$font = 'arial.ttf';\r\n    \timagettftext($im, 20, 0, 11, 21, $grey, $font, \t$text);\r\n    \timagettftext($im, 20, 0, 10, 20, $black, $font, \t$text);\r\n    \timagepng($im);\r\n\timagedestroy($im);\r\n     \r\n     ?>\r\n\r\n## Response.php\r\nThis page checks the user input against the session variable. If the user entered the correct string, the form submission will work.\r\n\r\n    <?\r\n     session_start(); \r\n     \r\n    if (isset($_SESSION['code'])) {\r\n    $code = $_POST['code'];\r\n       if ($code == $_SESSION[code]) {\r\n          echo \"Captcha Correct\";\r\n        } else {\r\n          echo \"Wrong Captcha\";\r\n    }\r\n    ?>\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n",
  "note": "Don't delete this file! It's used internally to help with page regeneration."
}