<!DOCTYPE html>
<html>
  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link href='https://fonts.googleapis.com/css?family=Architects+Daughter' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/github-light.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/print.css" media="print">

    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <title>Simple-php-captcha by tarjomeh</title>
  </head>

  <body>
    <header>
      <div class="inner">
        <h1>Simple-php-captcha</h1>
        <h2></h2>
        <a href="https://github.com/tarjomeh/Simple-PHP-Captcha" class="button"><small>View project on</small> GitHub</a>
      </div>
    </header>

    <div id="content-wrapper">
      <div class="inner clearfix">
        <section id="main-content">
          <p>In order to create a Simple PHP Captcha, we will need to create a Session in the main page where our captcha is going to appear. In the second step, we need to set a session variable with a Random String. The random string should be converted to image using imagettftext() and then it is called with cURL in base64 and it is added to the page. The captcha checking form sends the user input to a response page where it is checked against the session variable.</p>

<h2>
<a id="indexphp" class="anchor" href="#indexphp" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Index.php</h2>

<pre><code>&lt;?
//Start Session
session_start(); 

// Generate A Random String
function generateRandomString($length = 5) {
$characters = '0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ';
$charactersLength = strlen($characters);
$randomString = '';
for ($i = 0; $i &lt; $length; $i++) {
$randomString .= $characters[rand(0, $charactersLength - 1)];
}
return $randomString;
}
// Assign the Session With Random String
$_SESSION['code'] = generateRandomString();
$thcode = $_SESSION['code'];

// Convert String to Image and Grab it with CURL while it is Base64
$url = "image.php?t=$_SESSION[code]";
$curl = curl_init($url);
curl_setopt($curl, CURLOPT_RETURNTRANSFER, true );
$ret_val = curl_exec($curl);
$b64_image_data =  chunk_split(base64_encode($ret_val));
curl_close($curl);

// Show the Image
echo "&lt;img id='codeId' src='data:image/jpg;base64,$b64_image_data'&gt;&lt;br&gt;&lt;br&gt;

// Captcha Checking Form
&lt;form name='captchaCheck' action='response.php' method='POST'&gt;
&lt;input name='code' type='text' required&gt;
&lt;/form&gt;";

?&gt;
</code></pre>

<h2>
<a id="imagephp" class="anchor" href="#imagephp" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Image.php</h2>

<p>This page creates an image from our random string. You need to upload a font like "arial.ttf" in your root dir or any other folder.
    &lt;?
    //IMAGE Creator</p>

<pre><code>$text = $_GET[t];
header('Content-type: image/jpeg');
$im = imagecreatetruecolor(400, 30);
    $white = imagecolorallocate($im, 255, 255, 255);
    $grey = imagecolorallocate($im, 128, 128, 128);
    $black = imagecolorallocate($im, 0, 0, 0);
    imagefilledrectangle($im, 0, 0, 399, 29, $white);
    $font = 'arial.ttf';
    imagettftext($im, 20, 0, 11, 21, $grey, $font,  $text);
    imagettftext($im, 20, 0, 10, 20, $black, $font,     $text);
    imagepng($im);
imagedestroy($im);

 ?&gt;
</code></pre>

<h2>
<a id="responsephp" class="anchor" href="#responsephp" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Response.php</h2>

<p>This page checks the user input against the session variable. If the user entered the correct string, the form submission will work.</p>

<pre><code>&lt;?
 session_start(); 

if (isset($_SESSION['code'])) {
$code = $_POST['code'];
   if ($code == $_SESSION[code]) {
      echo "Captcha Correct";
    } else {
      echo "Wrong Captcha";
}
?&gt;
</code></pre>
        </section>

        <aside id="sidebar">
          <a href="https://github.com/tarjomeh/Simple-PHP-Captcha/zipball/master" class="button">
            <small>Download</small>
            .zip file
          </a>
          <a href="https://github.com/tarjomeh/Simple-PHP-Captcha/tarball/master" class="button">
            <small>Download</small>
            .tar.gz file
          </a>

          <p class="repo-owner"><a href="https://github.com/tarjomeh/Simple-PHP-Captcha"></a> is maintained by <a href="https://github.com/tarjomeh">tarjomeh</a>.</p>

          <p>This page was generated by <a href="https://pages.github.com">GitHub Pages</a> using the Architect theme by <a href="https://twitter.com/jasonlong">Jason Long</a>.</p>
        </aside>
      </div>
    </div>

  
  </body>
</html>
